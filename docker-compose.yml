services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: devopsmlops-backend
    ports:
      - "8000:8000"
    volumes:
      - ./app:/app/app
    environment:
      - PYTHONUNBUFFERED=1
      # Environment Configuration
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DEBUG=${DEBUG:-false}
      # API Configuration
      - API_HOST=${API_HOST:-0.0.0.0}
      - API_PORT=${API_PORT:-8000}
      - API_PREFIX=${API_PREFIX:-/api}
      # CORS Configuration
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000,http://localhost:5173,http://127.0.0.1:3000,http://127.0.0.1:5173}
      - CORS_ALLOW_ALL=${CORS_ALLOW_ALL:-true}
      # Logging Configuration
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - LOG_FILE=${LOG_FILE:-app/logs/app.log}
      - LOG_DIR=${LOG_DIR:-app/logs}

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        # Build-time environment variable for API URL
        # For local Docker: use localhost (browser can access)
        # For Kubernetes: use service name or API gateway URL
        - VITE_API_URL=${VITE_API_URL:-http://localhost:8000}
    container_name: devopsmlops-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend